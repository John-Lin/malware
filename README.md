Dynamic Malware Analysis
=======
Dynamic Malware Analysis is a project that automates the analysis of malware by generating a Snort rule via malicious network traffic. It provides a sandbox environment to isolate the malware and record its network behavior. It also includes a packet reconstruct tool to help reconstruct the payload of the captured packets.

## Requirement package
- [pyvbox](https://pypi.python.org/pypi/pyvbox): for creating an sandbox.
- [dpkt](https://code.google.com/p/dpkt/): for parsering network packet.
- [requests](http://docs.python-requests.org/en/latest/): for sending requests to [VirusTotal](https://www.virustotal.com/en/)

## Installation of Isolation environment in VirtualBox

1. Clone the repository.
2. Install the required packages and dependencies.
3. Set up a virtual machine with an operating system that supports Python, such as Windows XP or Windows 7.
4. Take a snapshot of the virtual machine (manually)
5. Copy the malware into the virtual machine.
6. Run the `sandbox_run.py` script to activate the malware and record the network traffic (save in the host) in the virtual machine
7. Restore the snapshot when the analysis is complete (which means go befor step 4)

## Usage

## Sandbox environment usage
The `sandbox_run.py` script is used to record malware network behavior in the isolation environment. The following arguments can be used:

``` python
$ python sandbox_run.py [-h] [-n NAME] [-t TIME] [-m MALWARE]
```

This is a automatic script which record malware network behavior in the isolation environment.

```
Optional arguments:
  -h, --help            show this help message and exit
  -n NAME, --name NAME  Specify a VM name.
  -t TIME, --time TIME  Specify a time in seconds for recording network
                        traffic.
  -m MALWARE, --malware MALWARE
                        Specify a path which place malware will be copy into
                        sandbox.
```

Show help messages: 

``` python
$ python sandbox_run.py -h
```

For example:

``` python
$ python sandbox_run.py -n WinXPSP3 -t 60 -m malware_bin
```

This will start a virtual machine named WinXPSP3 and capture network traffic for 60 seconds.

## Packet reconstruct usage
The `pkt_reconstruct.py` script is used to reconstruct the payload of the captured packets. The following arguments can be used:

``` pythonn
$ python pkt_reconstruct.py [-h] [-d DIRECTORY]
```

```
-d or --directory: Specify the path where the pcap files are located.
```

For example:

``` python
$ python pkt_reconstruct.py -d pcap_files
```

This is a packet reconstruct tool to help reconstruct the packet payload. It also will reconstruct the packets in the `pcap_files` directory.

```
Optional Arguments:
  -h, --help            show this help message and exit
  -d DIRECTORY, --directory DIRECTORY
                        Specify a path which place pcap file
                        
```
## Troubleshooting

If you encounter any issues when using the project, please refer to the following:

    -> Check that you have installed all the required packages and dependencies.
    -> Make sure that the virtual machine is set up correctly.
    -> If you encounter any issues with the packet reconstruct tool, make sure that the pcap files are located in the correct directory.

## Todo

1. Analysis malicious network traffic from packet reconstruct.
2. Automatic generate the snort rule depending on analyse results.
3. A Web GUI interface for user can upload the malware and generate snort rule.

## Contributions

Contributions to the project are welcome! If you want to contribute, please follow these guidelines:

1. Fork the repository.
2. Make your changes.
3. Submit a pull request.

## License
This project is licensed under the MIT License. See LICENSE for more information.

